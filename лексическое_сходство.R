###########################################################
# 0. Устанавливаем и подключаем пакеты
###########################################################

# Выполнить один раз, если ещё не установлены:
# install.packages("quanteda")
# install.packages("readr")

library(quanteda)
library(readr)
library(quanteda.textstats)

###########################################################
# 1. Читаем два текста из файлов
###########################################################

# Файлы "онегин.txt" и "набоков.txt" должны лежать в рабочей папке
text_onegin  <- read_file("онегин.txt")
text_nabokov <- read_file("набоков.txt")

# Собираем в один объект с именами
texts <- c(Onegin = text_onegin,
           Nabokov = text_nabokov)

###########################################################
# 2. Токенизация: разбиваем на слова, чистим
###########################################################

toks <- tokens(
  texts,
  remove_punct   = TRUE,   # убрать пунктуацию
  remove_numbers = TRUE    # убрать цифры
) |>
  tokens_tolower()         # всё в нижний регистр

stop_ru <- stopwords("ru")
toks <- tokens_remove(toks, pattern = stop_ru)



###########################################################
# 3. Строим DFM (document-feature matrix)
#    строки = тексты, столбцы = слова, значения = частоты
###########################################################

dfm_words <- dfm(toks)

dfm_words
# увидишь матрицу 2 x N:
# 2 текста, N разных слов (type'ов)

###########################################################
# 4. Пересечение словарей и Jaccard по множествам слов
###########################################################

# Множество разных слов в каждом тексте
types_onegin  <- featnames(dfm_words["Onegin", ])
types_nabokov <- featnames(dfm_words["Nabokov", ])

length(types_onegin)      # размер словаря Онегина
length(types_nabokov)     # размер словаря Набокова

# Пересечение словарей
common_types <- intersect(types_onegin, types_nabokov)
length(common_types)      # сколько общих слов

# Jaccard по множествам слов:
# |A ∩ B| / |A ∪ B|
union_types <- union(types_onegin, types_nabokov)

jaccard_types <- length(common_types) / length(union_types)
jaccard_types
# Это число от 0 до 1:
# 0 = словари не пересекаются,
# 1 = словари полностью совпадают.

###########################################################
# 5. Косинусное сходство по вектору частот слов
###########################################################

# Нормализуем частоты (до долей от общего числа слов)
dfm_rel <- dfm_weight(dfm_words, scheme = "prop")

# Косинусное сходство между строками (текстами)
sim_cosine <- textstat_simil(dfm_rel,
                             method = "cosine",
                             margin = "documents")

sim_cosine
# Это объект со значением косинусного сходства между "Onegin" и "Nabokov"

# Можно вытащить число:
as.matrix(sim_cosine)[1, 1]

###########################################################
# 6. (Необязательно) Посмотреть топ-10 самых частотных слов
#    в каждом тексте для иллюстрации
###########################################################

topfeatures(dfm_words["Onegin", ], 100)
topfeatures(dfm_words["Nabokov", ], 100)

